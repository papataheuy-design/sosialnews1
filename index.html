<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pordisk - Portal Diskusi</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f7f7f7; }
    header { background:#cfc; padding:10px; display:flex; justify-content:space-between; align-items:center; }
    #user-info { display:flex; align-items:center; gap:8px; }
    #user-pic { width:32px; height:32px; border-radius:50%; }
    .slider { position:relative; overflow:hidden; }
    .slide { display:none; padding:15px; background:#ffe; }
    .active { display:block; }
    .news-img { max-width:100%; border-radius:8px; }
    .news-actions { display:flex; justify-content:space-between; align-items:center; margin-top:8px; }
    .discussion, .forum { margin:15px; background:#fff; padding:10px; border-radius:8px; }
    .comment { background:#e8ffe8; padding:8px; margin:5px 0; border-radius:5px; }
    .reply { margin-left:20px; background:#f5f5f5; padding:6px; border-radius:5px; }
    button { cursor:pointer; }
  </style>
</head>
<body>
  <header>
    <div><b>Pordisk</b></div>
    <div id="user-info">
      <img id="user-pic" src="" alt="">
      <span id="user-name">Login</span>
      <button id="login-btn">Login</button>
      <button id="logout-btn" style="display:none;">Logout</button>
    </div>
  </header>

  <!-- Slider Berita -->
  <div class="slider" id="news-slider"></div>
  <div style="text-align:center; margin:10px;">
    <button onclick="prevSlide()">⏮</button>
    <button onclick="nextSlide()">⏭</button>
  </div>

  <!-- Forum Diskusi Umum -->
  <h3 style="text-align:center;">Portal Diskusi</h3>
  <div class="forum">
    <input id="forum-input" placeholder="Mulai Berdiskusi..." style="width:80%">
    <button onclick="postForum()">Kirim</button>
    <div id="forum-list"></div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

  <script>
    // Firebase config
    const firebaseConfig = {
      apiKey: "AIzaSyAN825UwYIJ6zGgOpb8fYWZBeBfOSvNNU4",
      authDomain: "socialnewshariini.firebaseapp.com",
      projectId: "socialnewshariini",
      storageBucket: "socialnewshariini.appspot.com",
      messagingSenderId: "579951188459",
      appId: "1:579951188459:web:83322616a6bfd971eea1ae",
      measurementId: "G-7KSKKSPFH4"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let currentUser = null;

    // Login
    document.getElementById("login-btn").onclick = async () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      await auth.signInWithPopup(provider);
    };
    document.getElementById("logout-btn").onclick = async () => { await auth.signOut(); };

    auth.onAuthStateChanged(user => {
      currentUser = user;
      if (user) {
        document.getElementById("user-pic").src = user.photoURL;
        document.getElementById("user-name").innerText = user.displayName;
        document.getElementById("login-btn").style.display="none";
        document.getElementById("logout-btn").style.display="inline";
      } else {
        document.getElementById("user-name").innerText = "Login";
        document.getElementById("login-btn").style.display="inline";
        document.getElementById("logout-btn").style.display="none";
      }
    });

    // Dummy berita contoh (bisa ganti fetch RSS)
    const newsData = [
      {id:"1", title:"Judul Berita Hari Ini", img:"https://picsum.photos/600/300", desc:"Isi ulasan berita yang cukup panjang..."},
      {id:"2", title:"Berita Kedua", img:"https://picsum.photos/601/300", desc:"Berita kedua terbaru..."},
      {id:"3", title:"Berita Ketiga", img:"https://picsum.photos/602/300", desc:"Berita ketiga singkat..."}
    ];

    const slider = document.getElementById("news-slider");
    let currentSlide = 0;

    function renderSlider() {
      slider.innerHTML = "";
      newsData.forEach((news,i)=>{
        const div=document.createElement("div");
        div.className="slide"+(i===currentSlide?" active":"");
        div.innerHTML=`
          <img class="news-img" src="${news.img}">
          <h3>${news.title}</h3>
          <p>${news.desc}</p>
          <input id="comment-input-${news.id}" placeholder="Beri tanggapan berita ini">
          <button onclick="postComment('${news.id}')">Kirim</button>
          <div id="comments-${news.id}"></div>
        `;
        slider.appendChild(div);
        loadComments(news.id);
      });
    }
    function nextSlide(){currentSlide=(currentSlide+1)%newsData.length;renderSlider();}
    function prevSlide(){currentSlide=(currentSlide-1+newsData.length)%newsData.length;renderSlider();}
    setInterval(nextSlide,12000);

    // Komentar berita
    function postComment(newsId){
      if(!currentUser) return alert("Login dulu");
      const text=document.getElementById("comment-input-"+newsId).value;
      if(text){
        db.collection("news_comments").add({
          newsId, text,
          uid:currentUser.uid, name:currentUser.displayName,
          ts:Date.now()
        });
        document.getElementById("comment-input-"+newsId).value="";
      }
    }
    function loadComments(newsId){
      db.collection("news_comments").where("newsId","==",newsId).orderBy("ts")
      .onSnapshot(snap=>{
        const box=document.getElementById("comments-"+newsId);
        box.innerHTML="";
        snap.forEach(doc=>{
          const d=doc.data();
          box.innerHTML+=`<div class="comment"><b>${d.name}:</b> ${d.text}</div>`;
        });
      });
    }

    // Forum umum
    function postForum(){
      if(!currentUser) return alert("Login dulu");
      const text=document.getElementById("forum-input").value;
      if(text){
        db.collection("forum_posts").add({
          text, uid:currentUser.uid, name:currentUser.displayName, ts:Date.now()
        });
        document.getElementById("forum-input").value="";
      }
    }
    db.collection("forum_posts").orderBy("ts").onSnapshot(snap=>{
      const list=document.getElementById("forum-list");
      list.innerHTML="";
      snap.forEach(doc=>{
        const d=doc.data();
        list.innerHTML+=`<div class="comment"><b>${d.name}:</b> ${d.text}</div>`;
      });
    });

    renderSlider();
  </script>
</body>
</html>
