<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>NEWSHUB Diskusi</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <style>
    body{margin:0;font-family:Poppins,sans-serif;background:#f5f7fa;color:#222}
    header{display:flex;justify-content:space-between;align-items:center;padding:10px 20px;background:#4361ee;color:#fff;position:sticky;top:0;z-index:10}
    .logo{font-weight:600;font-size:18px}
    #authBtn{background:#fff2;border:none;padding:6px 12px;border-radius:20px;color:#fff;cursor:pointer;display:flex;align-items:center;gap:8px}
    #authBtn img{width:28px;height:28px;border-radius:50%}
    .banner{height:280px;position:relative;overflow:hidden}
    .slide{position:absolute;width:100%;height:100%;opacity:0;transition:opacity 1s;background-size:cover;background-position:center;display:flex;flex-direction:column;justify-content:flex-end;padding:20px;color:#fff;background-color:rgba(0,0,0,.4);background-blend-mode:darken}
    .slide.active{opacity:1}
    .slide h2{margin:0 0 8px;font-size:20px}
    .slide p{margin:0 0 10px;font-size:14px}
    .actions{display:flex;gap:10px}
    .btn{display:flex;align-items:center;gap:5px;padding:4px 10px;border:none;border-radius:16px;cursor:pointer;font-size:13px}
    .btn.source{background:#fff2;color:#fff}
    .btn.react{background:#fff2;color:#fff}
    .forum{max-width:700px;margin:20px auto;padding:0 15px}
    .form{background:#fff;padding:15px;border-radius:8px;margin-bottom:20px;box-shadow:0 1px 4px rgba(0,0,0,.1)}
    textarea{width:100%;padding:10px;border:1px solid #ccc;border-radius:6px;font-family:inherit;margin-bottom:10px}
    .discussion{background:#fff;border-radius:8px;box-shadow:0 1px 4px rgba(0,0,0,.1);margin-bottom:15px;padding:15px}
    .discussion .head{display:flex;align-items:center;gap:10px;margin-bottom:8px}
    .discussion .head img{width:32px;height:32px;border-radius:50%}
    .discussion .user{font-weight:600;font-size:14px}
    .discussion .time{font-size:12px;color:#666}
    .discussion .text{margin:8px 0}
    .discussion .act{display:flex;gap:15px;font-size:13px;align-items:center}
    .loading{text-align:center;padding:20px;color:#666}
    @media(max-width:500px){.slide h2{font-size:16px}}
  </style>
</head>
<body>
<header>
  <div class="logo">NEWSHUB</div>
  <button id="authBtn"><span class="material-icons">account_circle</span> Masuk</button>
</header>

<!-- Banner Berita -->
<div class="banner" id="banner"><div class="loading">Memuat berita...</div></div>

<!-- Forum Diskusi -->
<div class="forum">
  <div class="form">
    <textarea id="input" rows="3" placeholder="Apa pendapatmu?"></textarea>
    <button id="postBtn">Posting</button>
  </div>
  <h3>Diskusi Terbaru</h3>
  <div id="list"><div class="loading">Memuat diskusi...</div></div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig={apiKey:"AIzaSyAN825UwYIJ6zGgOpb8fYWZBeBfOSvNNU4",
authDomain:"socialnewshariini.firebaseapp.com",projectId:"socialnewshariini",
storageBucket:"socialnewshariini.appspot.com",messagingSenderId:"579951188459",
appId:"1:579951188459:web:83322616a6bfd971eea1ae"};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth(),db=firebase.firestore();
let user=null,newsData=[],slides=[],idx=0,timer;

// Auth
auth.onAuthStateChanged(u=>{
  user=u;
  const btn=document.getElementById("authBtn");
  if(u&&!u.isAnonymous){
    btn.innerHTML=`<img src="${u.photoURL||''}"/> ${u.displayName||'User'}`;
  }else{
    btn.innerHTML='<span class="material-icons">account_circle</span> Masuk';
  }
});
document.getElementById("authBtn").onclick=()=>{
  if(user&&!user.isAnonymous) auth.signOut();
  else auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
};

// News RSS
async function loadNews(){
  const src="https://api.rss2json.com/v1/api.json?rss_url=https://rss.detik.com/index.php/detikcom";
  try{
    const res=await fetch(src),data=await res.json();
    newsData=(data.items||[]).slice(0,5).map(n=>({
      id:n.guid,title:n.title,desc:n.description.replace(/<[^>]+>/g,''),img:n.enclosure?.link||"https://via.placeholder.com/600x300",link:n.link
    }));
  }catch(e){newsData=[]}
  renderSlides();
}
function renderSlides(){
  const cont=document.getElementById("banner");slides=[];
  cont.innerHTML="";
  newsData.forEach((n,i)=>{
    const d=document.createElement("div");
    d.className="slide"+(i==0?" active":"");
    d.style.backgroundImage=`url(${n.img})`;
    d.innerHTML=`<h2>${n.title}</h2><p>${n.desc.slice(0,100)}...</p>
      <div class="actions">
        <a href="${n.link}" target="_blank" class="btn source"><span class="material-icons">open_in_new</span> Sumber</a>
        <button class="btn react" onclick="startDiscuss('${n.id}','${n.title}')"><span class="material-icons">chat_bubble</span> Diskusi</button>
      </div>`;
    cont.appendChild(d);slides.push(d);
  });
  if(slides.length>1) timer=setInterval(nextSlide,5000);
}
function nextSlide(){slides[idx].classList.remove("active");idx=(idx+1)%slides.length;slides[idx].classList.add("active");}

// Diskusi
async function loadDiscussions(){
  const list=document.getElementById("list");
  try{
    const snap=await db.collection("discussions").orderBy("time","desc").limit(50).get();
    if(snap.empty){list.innerHTML='<p style="text-align:center;color:#666">Belum ada diskusi</p>';return;}
    list.innerHTML="";
    snap.forEach(doc=>{
      const d=doc.data();
      const liked=d.likes&&user?d.likes.includes(user.uid):false;
      const el=document.createElement("div");
      el.className="discussion";
      el.innerHTML=`
        <div class="head">
          ${d.photo?`<img src="${d.photo}">`:`<span class="material-icons">account_circle</span>`}
          <div><div class="user">${d.name||'Anonim'}</div>
          <div class="time">${d.time?.toDate().toLocaleString("id-ID")||''}</div></div>
        </div>
        <div class="text">${d.text}</div>
        <div class="act">
          <button onclick="toggleLike('${doc.id}',${liked})" class="btn"><span class="material-icons">thumb_up</span> ${(d.likes||[]).length}</button>
        </div>`;
      list.appendChild(el);
    });
  }catch(e){list.innerHTML="<p>Gagal memuat diskusi</p>";}
}
function postDiscussion(){
  if(!user||user.isAnonymous){alert("Login dulu");return;}
  const txt=document.getElementById("input").value.trim();
  if(!txt)return;
  db.collection("discussions").add({
    text:txt,name:user.displayName||"Anonim",photo:user.photoURL||"",
    uid:user.uid,likes:[],time:firebase.firestore.FieldValue.serverTimestamp()
  }).then(()=>{document.getElementById("input").value="";loadDiscussions();});
}
function toggleLike(id,liked){
  if(!user)return alert("Login dulu");
  const ref=db.collection("discussions").doc(id);
  if(liked) ref.update({likes:firebase.firestore.FieldValue.arrayRemove(user.uid)});
  else ref.update({likes:firebase.firestore.FieldValue.arrayUnion(user.uid)});
  setTimeout(loadDiscussions,500);
}
function startDiscuss(id,title){
  document.getElementById("input").value=`[Berita: ${title}] `;
  window.scrollTo({top:document.querySelector(".form").offsetTop,behavior:"smooth"});
}

document.getElementById("postBtn").onclick=postDiscussion;

// Init
loadNews();loadDiscussions();
</script>
</body>
</html>
